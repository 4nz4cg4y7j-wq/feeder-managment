<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Feeder System Login/Register</title>
<link rel="stylesheet" href="css/style.css">
<style>
  body { font-family: Arial, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background: #f0f2f5; margin: 0; }
  .container { background: #fff; padding: 2em; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
  h2 { text-align: center; margin-bottom: 1em; }
  form { display: flex; flex-direction: column; }
  label { margin: 0.5em 0 0.2em; }
  input { padding: 0.5em; margin-bottom: 1em; border-radius: 5px; border: 1px solid #ccc; }
  button { padding: 0.7em; background: #007bff; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
  button:hover { background: #0056b3; }
  .toggle { text-align: center; margin-top: 1em; cursor: pointer; color: #007bff; }
  .toggle:hover { text-decoration: underline; }
  #message { color: red; text-align: center; margin-top: 0.5em; }
</style>
</head>
<body>
<div class="container">
  <h2 id="formTitle">Login</h2>

  <form id="authForm">
    <div id="usernameField">
      <label>Username</label>
      <input type="text" id="username" required>
    </div>

    <div id="emailField" style="display:none;">
      <label>Email</label>
      <input type="email" id="email">
    </div>

    <label>Password</label>
    <input type="password" id="password" required>

    <button type="submit" id="submitBtn">Login</button>
  </form>

  <div class="toggle" id="toggleForm">Switch to Register</div>
  <p id="message"></p>
</div>

<script>
let isRegister = false;

const toggle = document.getElementById('toggleForm');
const formTitle = document.getElementById('formTitle');
const emailField = document.getElementById('emailField');
const submitBtn = document.getElementById('submitBtn');
const message = document.getElementById('message');

toggle.addEventListener('click', () => {
  isRegister = !isRegister;
  if(isRegister){
    formTitle.innerText = 'Register';
    emailField.style.display = 'block';
    submitBtn.innerText = 'Register';
    toggle.innerText = 'Switch to Login';
  } else {
    formTitle.innerText = 'Login';
    emailField.style.display = 'none';
    submitBtn.innerText = 'Login';
    toggle.innerText = 'Switch to Register';
  }
});

document.getElementById('authForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const username = document.getElementById('username').value;
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;

  const url = isRegister ? '/api/register' : '/api/login';
  const bodyData = isRegister ? { username, email, password } : { username, password };

  try {
    const res = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(bodyData),
      credentials: 'include'
    });

    const data = await res.json();
    if(res.ok && data.success){
      if(isRegister){
        message.style.color = 'green';
        message.innerText = 'Registration successful! You can now login.';
        toggle.click();
      } else {
        window.location.href = '/dashboard.html';
      }
    } else {
      message.style.color = 'red';
      message.innerText = data.error || 'Operation failed';
    }
  } catch(err) {
    message.style.color = 'red';
    message.innerText = 'Server error. Try again later.';
    console.error(err);
  }
});
</script>
</body>
</html>
